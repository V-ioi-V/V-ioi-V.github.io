---
title: 网络基础(上)
tags: 计算机网络原理
category: CS大学生必备
---



如果不分层，可能下层的开发和各种协议都要学，但是做了分层，只需要开发应用层，然后接入下层API就可。

<!--more-->

# OSI、TCP/IP、五层协议

- OSI分层 （7层）：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。

- TCP/IP分层（4层）：网络接口层、 网际层、运输层、 应用层。

  - 前三层一般在内核执行，应用程序通常是用户进程。
  - 应用层关心应用程序的细节，下三层处理通讯细节。
  - 互联网的目的之一就是在应用程序中隐藏所有的物理细节

- 五层协议 （5层）：物理层、数据链路层、网络层、运输层、 应用层。

  **每一层的协议如下：**

- 物理层：RJ45、CLOCK、IEEE802.3 （中继器，集线器）

- 数据链路：PPP、FR、HDLC、VLAN、MAC （网桥，交换机）

- 网络层：IP、ICMP、ARP、RARP、OSPF、IPX、RIP、IGRP、 （路由器）

- 传输层：TCP、UDP、SPX

- 会话层：NFS、SQL、NETBIOS、RPC

- 表示层：JPEG、MPEG、ASII

- 应用层：FTP、DNS、Telnet、SMTP、HTTP、WWW、NFS

  **每一层的作用如下：**

- 物理层：通过媒介传输比特,确定机械及电气规范（比特Bit）

- 数据链路层：将比特组装成帧和点到点的传递（帧Frame）

- 网络层：负责数据包从源到宿的传递和网际互连（包PackeT）[46,1500]

- 传输层：提供端到端的可靠报文传递和错误恢复（段Segment）

- 会话层：建立、管理和终止会话（会话协议数据单元SPDU）

- 表示层：对数据进行翻译、加密和压缩（表示协议数据单元PPDU）

- 应用层：允许访问OSI环境的手段（应用协议数据单元APDU）

# IP地址的分类

![20160712182446560.jpeg](https://i.loli.net/2020/03/16/6EPTuHXgCRAp4Ms.png)

- A类地址：以0开头，  第一个字节范围：1~126（1.0.0.0 - 126.255.255.255）；

  ~~127.0.0.0到127.255.255.255是保留地址，用做循环测试用的。比如你ping 127.0.0.1,和ping本机的IP是一样的效果 127.0.0.1是本地主机IP,就是用来测试的。~~

- B类地址：以10开头，  第一个字节范围：128~191（128.0.0.0 - 191.255.255.255）；

- C类地址：以110开头， 第一个字节范围：192~223（192.0.0.0 - 223.255.255.255）；

- D类地址：以1110开头，第一个字节范围：224~239（224.0.0.0 - 239.255.255.255）；（作为多播使用）

- E类地址：保留

## 适用范围

- A类适用的类型为大型网络，A类网络地址数量较少，有126个网络，每个网络支持的最大主机数为256的3次方-2=16777214台；
- B类适用的类型为中型网络，B类网络地址数量适中，有16384个网络，每个网络支持的最大主机数为256的2次方-2=65534台；
- C类适用的类型为小型网络，C类网络地址数量较多，有209万余个网络，适用于小规模的局域网络，每个网络支持的最大主机数为256的
  

**其中A、B、C是基本类，D、E类作为多播和保留使用。以下是留用的内部私有地址：**

A类 10.0.0.0--10.255.255.255

B类 172.16.0.0--172.31.255.255

C类 192.168.0.0--192.168.255.255



**IP地址与子网掩码相与得到网络号：**

子网掩码只有一个作用，就是将某个IP地址划分成网络地址和主机地址两部分。 

ip    : 192.168.2.110  &   Submask : 255.255.255.0

\----------------------------

网络号  ：192.168.2.0

**我们将网络号相同的网络称为本地网络，网络号不相同的主机称之为远程网络主机，本地网络中的主机可以直接相互通信；远程网络中的主机要相互通信必须通过本地网关（Gateway）来传递转发数据。**

计算机的网关（Gateway）就是到其他网段的出口，也就是路由器接口IP地址。路由器接口使用的IP地址可以是本网段中任何一个地址，不过通常使用该网段的**第一个可用的地址或最后一个可用的地址**，这是为了尽可能避免和本网段中的主机地址冲突。

注:

主机号，全为0的是网络号（例如：192.168.2.0）表示本网段，主机号全为1的为广播地址（192.168.2.255）

## 子网掩码的分类

**①、缺省子网掩码**

也叫默认子网掩码，即未划分子网，对应的网络号的位都置 1 ，主机号都置 0 。

未做子网划分的IP地址：网络号＋主机号

A类网络缺省子网掩码： 255.0.0.0，用CIDR表示为/8，（**CIDR斜线记法**，表示子网掩码的方法）

B类网络缺省子网掩码： 255.255.0.0，用CIDR表示为/16

C类网络缺省子网掩码： 255.255.255.0，用CIDR表示为/24

**②、自定义子网掩码**

将一个网络划分子网后，把原本的主机号位置的一部分给了子网号，余下的才是给了子网的主机号。其形式如下：

做子网划分后的IP地址：网络号＋子网号＋子网主机号

举个栗子：

如：192.168.1.100/25，其子网掩码表示：255.255.255.128

意思就是将192.168.1.0这个网段的主机位的最高1位划分为了子网。

**为什么要要划分子网？**

例如：在A类IP地址中，每个A类网络可能有16，777，214台主机，它们处于同一广播域。在同一广播域中有这么多主机是不可能的，网络会因为广播通信而饱和。另一方面，IP地址资源越来越少。**为实现更小的广播域**，就需要进一步分成更小的网络。划分子网后，通过使用掩码，把子网隐藏起来，使得从外部看网络没有变化，这就是子网掩码。

**两个不同的主机怎么知道对方是不是在自己的局域网里？**

假设一个主机A想和主机B通信，但是现在主机A手中唯一的信息就是主机B的IP地址，所以主机A就会拿自己和B的IP地址与自己的子网掩码做"与"运算，运算结果就是二者的主机号，然后再来作比较，相同的话就是同一网段，不相同的话就是不同网段，需要通过网关转发，**之前有一个疑问就是:：**ABC类的子网掩码是不同的，会不会两个不同类的IP地址之间通信会导致由于二者子网掩码不同而导致的做（&）运算时算的是主机号，仔细观察就会发现ABC类地址的最前面0的位置，不管是怎样的运算，都不可能运算出相同的主机号来，因为前面那几位不同网段肯定是不一样的。

# ARP（地址解析协议）

## 出现的原因

ARP协议是“Address Resolution Protocol”（地址解析协议）的缩写。其作用是在以太网环境中，数据的传输所依懒的是MAC地址而非IP地址，而将已知IP地址转换为MAC地址的工作是由ARP协议来完成的。

在局域网中，网络中实际传输的是“帧”，帧里面是有目标主机的MAC地址的。在以太网中，一个主机和另一个主机进行直接通信，必须要知道目标主机的MAC地址。但这个目标MAC地址是如何获得的呢？它就是通过地址解析协议获得的。所谓“地址解析”就是主机在发送帧前将目标IP地址转换成目标MAC地址的过程。ARP协议的基本功能就是通过目标设备的IP地址，查询目标设备的MAC地址，以保证通信的顺利进行。(如果不是同一个网段，也会通过arp得到网关的MAC地址。)

## 工作原理

- 首先，每个主机都会在自己的**ARP缓冲区**中建立一个ARP列表，以表示IP地址和MAC地址之间的对应关系。
- 当源主机要发送数据时，首先检查ARP列表中是否有对应IP地址的目的主机的MAC地址，如果有，则直接发送数据，如果没有，就向本网段的所有主机发送ARP数据包，该数据包包括的内容有：源主机 IP地址，源主机MAC地址，目的主机的IP 地址。
- 当本网络的所有主机收到该ARP数据包时，首先检查数据包中的IP地址是否是自己的IP地址，如果不是，则忽略该数据包，如果是，则首先从数据包中取出源主机的IP和MAC地址写入到ARP列表中，如果已经存在，则覆盖，然后将自己的MAC地址写入**ARP响应包**中，告诉源主机自己是它想要找的MAC地址。
- 源主机收到ARP响应包后。将目的主机的IP和MAC地址写入ARP列表，并利用此信息发送数据。如果源主机一直没有收到ARP响应数据包，表示ARP查询失败。
- 广播发送ARP请求，单播发送ARP响应。

## RARP协议

​        RARP是逆地址解析协议，作用是完成硬件地址到IP地址的映射，主要用于无盘工作站，因为给无盘工作站配置的IP地址不能保存。

​        工作流程：在网络中配置一台RARP服务器，里面保存着IP地址和MAC地址的映射关系，当无盘工作站启动后，就封装一个RARP数据包，里面有其MAC地址，然后广播到网络上去，当服务器收到请求包后，就查找对应的MAC地址的IP地址装入响应报文中发回给请求者。因为需要广播请求报文，因此RARP只能用于具有广播能力的网络。

# ping

​        ping使用的是ICMP协议，它发送ICMP回送请求消息给目的主机。ICMP协议规定：目的主机必须返回ICMP回送应答消息给源主机。如果源主机在一定时间内收到应答，则认为主机可达。ICMP协议通过IP协议发送的，IP协议是一种无连接的，不可靠的数据包协议，可靠性由ICMP协议解决。
​        假定主机A的IP地址是192.168.1.1，主机B的IP地址是192.168.1.2，都在同一子网内，则当你在主机A上运行“Ping 192.168.1.2”后，都发生了些什么呢?

​      首先，Ping命令会构建一个固定格式的ICMP请求数据包，然后由ICMP协议将这个数据包连同地址192.168.1.2一起交给IP协议（和ICMP一样，实际上是一组后台运行的进程），IP层协议将以地址“192.168.1.2”作为目的地址，本机IP地址作为源地址，加上一些其他的控制信息，构建一个IP数据包，并在一个映射表(由ARP)协议实现中查找出IP地址192.168.1.2所对应的物理地址（也叫MAC地址，熟悉网卡配置的朋友不会陌生，这是数据链路层协议构建数据链路层的传输单元——帧所必需的），一并交给数据链路层。后者构建一个数据帧，目的地址是IP层传过来的物理地址，源地址则是本机的物理地址，还要附加上一些控制信息，依据以太网的介质访问规则，将它们传送出去。
​        主机B收到这个数据帧后，先检查它的目的地址，并和本机的物理地址对比，如符合，则接收；否则丢弃。接收后检查该数据帧，将IP数据包从帧中提取出来，交给本机的IP层协议。同样，IP层检查后，将有用的信息提取后交给ICMP协议，后者处理后，马上构建一个ICMP应答包，发送给主机A，其过程和主机A发送ICMP请求包到主机B一模一样。
​        即先由IP地址在网络层传输，然后再根据MAC地址由数据链路层传送到目的主机，目的主机收到后回复。
涉及到的协议有：

- ICMP协议
- IP 协议
- ARP 协议 

# 各种协议的介绍

- ICMP协议： 因特网控制报文协议（网络层）。它是TCP/IP协议族的一个子协议，用于在IP主机、路由器之间传递控制消息。 **功能：确认IP包是否成功到达目标地址；通知在发送过程中IP包被丢弃的原因.**
- TFTP协议： 是TCP/IP协议族中的一个用来在客户机与服务器之间进行简单文件传输的协议，提供不复杂、开销不大的文件传输服务。
- HTTP协议： 超文本传输协议，是一个属于应用层的面向对象的协议，由于其简捷、快速的方式，适用于分布式超媒体信息系统。
- NAT协议：网络地址转换属接入广域网(WAN)技术，是一种将私有（保留）地址转化为合法IP地址的转换技术，
- DHCP协议：动态主机配置协议，是一种让系统得以连接到网络上，并获取所需要的配置参数手段，使用UDP协议工作。具体用途：给内部网络或网络服务供应商自动分配IP地址，给用户或者内部网络管理员作为对所有计算机作中央管理的手段。**没有分配前，ip地址为0:0:0:0**

- traceroute：采用的是**UDP协议**利用ICMP会返回丢包原因和IP的TTL来找到主机之间所有的路由器，首先TTL设置成1，就会找到距离原主机1个单位的路由器。依次把TTL+1，得到所有的信息。把目的端口号设置成大于30000，也就是基本上不可能存在的那种，每次TTL++时，目的端口号也++，这样的话，每次如果到达的还是路由器就会返回超时，到达目的主机的话就会返回端口不可达，就知道自己已经找完了。