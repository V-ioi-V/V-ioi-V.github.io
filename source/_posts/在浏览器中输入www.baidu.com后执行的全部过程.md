---
title: 在浏览器中输入www.baidu.com后执行的全部过程
tags: 计算机网络原理
category: CS大学生必备
---

<font size=4>

## 从系统网络的角度分析输入www.baidu.com后的过程：

- 客户端浏览器通过DNS解析到www.baidu.com的IP地址a，通过这个IP地址找到客户端到服务器的路径。客户端浏览器发起一个HTTP会话到a，然后通过TCP进行封装数据包，输入到网络层。
- 在客户端的传输层，把HTTP会话请求分成报文段，添加源和目的端口，如服务器使用80端口监听客户端的请求，客户端由系统随机选择一个端口如5000，与服务器进行交换，服务器把相应的请求返回给客户端的5000端口。然后使用IP层的IP地址查找目的端。
- 客户端的网络层不用关心应用层或者传输层的东西，主要做的是通过查找路由表确定如何到达服务器，期间可能经过多个路由器，这些都是由路由器来完成的工作，无非就是通过查找路由表决定通过那个路径到达服务器。
- 客户端的链路层，包通过链路层发送到路由器，通过邻居协议查找给定IP地址的MAC地址，然后发送ARP请求查找目的地址，如果得到回应后就可以使用ARP的请求应答交换的IP数据包现在就可以传输了，然后发送IP数据包到达服务器的地址。

## 网络部分详细

### 1、应用层DNS解析域名发起HTTP请求报文（域名 to IP）

​    通过这个IP地址找到客户端到服务器的路径。客户端浏览器发起一个HTTP会话（HTTP请求包）到220.181.27.48。然后**通过传输层（TCP进行封装数据包，输入到网络层）**。

​    其中：http请求包括

​    请求行：GET/POST…，目标URL，HTTP 版本

​    请求头：客户端的Cookie和User-Agent就放在这里

​    请求体：比如客户端POST的数据就放在这里(对比:GET的数据放在请求行的URL里).

###  2、传输层TCP分割成报文段并加端口

​     TCP 的主要任务是运输它的上层协议的业务逻辑内容,不过可是不很容易,它至少得解决:

- 后发送的比之前发送的还早到了怎么办?
- 对方是否掉线了?还传吗?
- 网络堵塞的时候付款信息是不是得比其它信息先走?
- TCP 要保证,要么到不了,要么就得正确地到

​    在传输层（TCP 协议）把从应用层处收到的数据（HTTP 请求报文）进行分割（报文段），并在各个报文上打上标记序号及端口号后转发给网络层。

​    TCP协议为传输报文提供可靠的字节流服务。它为了方便传输，将大块的数据分割成以报文段为单位的数据包进行管理，并为它们编号，方便服务器接收时能准确地还原报文信息。把HTTP会话请求分成报文段，添加源和目的端口，如服务器使用80端口监听客户端的请求，客户端由系统随机选择一个端口如5000，与服务器进行交换，服务器把相应的请求返回给客户端的5000端口。然后使用网络层的IP地址查找目的端。TCP协议通过“三次握手”等方法保证传输的安全可靠。

 ### 3、网络层查找MAC地址（路由器）（IP、ICMP、ARP、RARP）（IP to MAC）
​    IP协议的作用是把TCP分割好的各种数据包加上IP首部后传送给接收方。而要保证确实能传到接收方还需要接收方的MAC地址，也就是物理地址。IP地址和MAC地址是一一对应的关系。ARP协议可以将IP地址解析成对应的MAC地址。当通信的双方不在同一个局域网时，需要多次中转才能到达最终的目标，在中转的过程中需要通过下一个中转站（交换机）的MAC地址来搜索下一个中转目标。

​    我们知道有个 MAC 地址,那为何还要发明个 ip 地址呢?要是只有 MAC 地址,我让百度下线就太容易了,把我自己的 MAC 地址改成百度的 MAC 地址,我们一冲突你们就都不能访问了.要想让 Internet 能够正常互相访问需要有个权威的人去维护 ip 地址,不能每个人都能生成使用,实际上确实有那么个机构负责分配 ip 地址,你只能在你的网络或者系统上作威作福,你可影响不到整个 Internet,正应了协议的名称.

###  4、网络接口层
​    在找到对方的MAC地址后，就将数据发送到数据链路层传输，由数据链路层的网桥、交换机根据mac地址进行端口转发，再由物理层的中继器、集线器进行信号传输放大等。这时，客户端发送请求的阶段结束

 

###  5、服务器接收数据
​    接收端的服务器在链路层接收到数据包，再层层向上直到应用层。这过程中包括在传输层通过TCP协议将分段的数据包重新组成原来的HTTP请求报文。

 

###  6、服务器响应请求，返回HTTP响应
​    服务接收到客户端发送的HTTP请求后，查找客户端请求的资源，并返回响应报文，响应报文中包括一个重要的信息——状态码。状态码由三位数字组成，其中比较常见的是200 OK表示请求成功。301表示永久重定向，即请求的资源已经永久转移到新的位置。在返回301状态码的同时，响应报文也会附带重定向的url，客户端接收到后将http请求的url做相应的改变再重新发送。404 not found 表示客户端请求的资源找不到。

​    其中：HTTP响应如下

​    响应行：HTTP版本，状态码，状态码描述

​    响应头：set-cookies，server信息

​    响应体：cookie，html，image，后端返回的请求数据等等

 ### 7、服务器返回相应文件
​    请求成功后，服务器会返回相应的HTML文件。接下来就到了页面的渲染阶段了。

## 事件顺序：

1. 根据域名，进行DNS域名解析。
2. 拿到解析的IP地址，建立TCP连接
3. 发送HTTP请求
4. 服务器处理请求
5. 返回HTTP报文
6. 关闭TCP链接
7. 浏览器解析HTML
8. 浏览器渲染页面

## 涉及到的协议:

- **应用层**：HTTP(超文本传输协议)，DNS(域名解析服务)
  DNS解析域名为目的IP，通过IP找到服务器路径，客户端向服务器发起HTTP会话，然后通过运输层TCP协议封装数据包，在TCP协议基础上进行传输。
- **传输层**：TCP(为HTTP提供可靠的数据传输)，UDP(DNS使用UDP传输)，HTTP会话会被分成报文段，添加源、目的端口；TCP协议进行主要工作。
- **网络层**：IP(IP数据数据包传输和路由选择)，ICMP(提供网络传输过程中的差错检测)，ARP(将本机的默认网关IP地址映射成物理MAC地址)为数据包选择路由，IP协议进行主要工作，相邻结点的可靠传输，ARP协议将IP地址转成MAC地址。
