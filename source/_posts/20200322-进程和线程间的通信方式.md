---
title: 进程和线程间的通信方式
tags: 操作系统
category: CS大学生必备
date: 2020/03/22 22:28
---

进程间通信（IPC，InterProcess Communication）是指在不同进程之间传播或交换信息.

IPC的方式通常有管道（包括无名管道和命名管道）、消息队列、信号量、共享存储、Socket、Streams等。其中 Socket和Streams支持不同主机上的两个进程IPC。

线程中的通信一般是用来同步

<!--more-->

<font size=4>

# 进程间的通信方式

## 一、管道

管道，通常指无名管道，是 UNIX 系统IPC最古老的形式。

### 特点：
它是半双工的（即数据只能在一个方向上流动），具有固定的读端和写端。

它只能用于具有亲缘关系的进程之间的通信（也是父子进程或者兄弟进程之间）。

（父子进程或者兄弟进程指的是fork或者vfork创建的工程

- **fork()创建的子进程拥有了自己的栈和数据段拷贝，而且，在子进程中对父进程变量的修改，不会影响父进程；**

- **vfork()创建的子进程共享父进程的内存，所以在子进程中对父进程变量的修改，会影响父进程。**

它可以看成是一种特殊的文件，对于它的读写也可以使用普通的read、write 等函数。但是它不是普通的文件，并不属于其他任何文件系统，并且只存在于内存中。

## 二、FIFO

FIFO，也称为命名管道，它是一种文件类型。

### 特点

FIFO可以在无关的进程之间交换数据，与无名管道不同。

FIFO有路径名与之相关联，它以一种特殊设备文件形式存在于文件系统中。

## 三、消息队列

消息队列，是消息的链接表，存放在内核中。一个消息队列由一个标识符（即队列ID）来标识。

### 特点

消息队列是面向记录的，其中的消息具有特定的格式以及特定的优先级。

消息队列独立于发送与接收进程。进程终止时，消息队列及其内容并不会被删除。

消息队列可以实现消息的随机查询,消息不一定要以先进先出的次序读取,也可以按消息的类型读取。

## 四、信号量

信号量（semaphore）与已经介绍过的 IPC 结构不同，它是一个计数器。信号量用于实现进程间的互斥与同步，而不是用于存储进程间通信数据。

### 特点

信号量用于进程间同步，若要在进程间传递数据需要结合共享内存。

信号量基于操作系统的 PV 操作，程序对信号量的操作都是原子操作。

每次对信号量的 PV 操作不仅限于对信号量值加 1 或减 1，而且可以加减任意正整数。

支持信号量组。

## 五、共享内存

共享内存（Shared Memory），指两个或多个进程共享一个给定的存储区。

### 特点

共享内存是最快的一种 IPC，因为进程是直接对内存进行存取。

因为多个进程可以同时操作，所以需要进行同步。

信号量+共享内存通常结合在一起使用，信号量用来同步对共享内存的访问。

# 线程间的通信（主要用来同步，没有数据交换）

## **为什么要线程同步？**

当多个线程**同时读写同一份共享资源的时候**，可能会引起冲突。这时候，我们需要引入线程“同步”机制，即各个线程之间要有先来后到，不能一窝蜂同时挤上去抢作一团。

线程同步其实就是相对于现实中的“排队”,几个线程之间要排队，一个一个对共享资源进行操作，而不是同时进行操作。

**线程同步是为了防止多个线程同时访问同一个数据对象时，对数据造成破坏。**

**线程的同步是保证多线程安全访问资源的一种手段。**

1、**锁机制**

互斥锁：提供了以排它方式阻止数据结构被并发修改的方法。

读写锁：允许多个线程同时读共享数据，而对写操作互斥。

条件变量：可以以原子的方式阻塞进程，直到某个特定条件为真为止。对条件测试是在互斥锁的保护下进行

的。条件变量始终与互斥锁一起使用。

2、**信号量机制**：包括无名线程信号量与有名线程信号量

3、**信号机制**：类似于进程间的信号处理。



**死锁条件：互斥、不可剥夺、循环等待、请求与保持。**

详细见：https://www.cnblogs.com/WindSun/p/11441234.html