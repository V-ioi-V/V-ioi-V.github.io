---
title: C++内存分配(静态内存、栈、堆)
tags: C++
category: CS大学生必备
---

内存数据存放区域分为三种：静态内存、栈内存、堆内存。

<!--more-->

<font size=4>

## 内存分配布局

![6.png](https://i.loli.net/2020/05/10/GFkz5AiatTe6Ho2.png)

## 静态内存

**保存的对象：**

1.局部static变量

```c++
void func()
{
	static int a;    //局部static对象
}
```

2.类static数据成员变量

```c++
class Function(){
public:
	static void func();    //类中static函数
private:
	static int i_func;    //类中static变量
};
```

3.全局static变量

4.全局变量

**生命周期：**

- 内存在程序编译的时候已经分配好，这块内存在程序的整个运行期间都存在。

**静态内存中又分为bss（未初始化数据段）和已初始化数据段**

已初始化的全局变量和局部静态变量都保存在data段；未初始化的全局变量和局部静态变量一般放在一个叫“bss”的段里。**我们知道未初始化的全局变量和局部静态变量默认值都为0，本来它们也可以被放在.data段的，但是因为它们都是0，所以为它们在.data段分配空间并且存放数据0是没有必要的。**程序运行的时候它们的确是要占内存空间的，并且可执行文件必须记录所有未初始化的全局变量和局部静态变量的大小总和，记为.bss段。所以.bss段只是为未初始化的全局变量和局部静态变量预留位置而已，它并没有内容，所以它在文件中也不占据空间。

## 栈内存

- 大小一般是 1M 或者 2M 。

**保存的对象：**

1. 定义在函数内的非static变量

```c++
void func()
{
	int i_func;    //定义在函数内的非static对象
}
```

**生命周期：**

- 仅在其定义的程序块运行时才存在。

在执行函数时，函数内局部变量的存储单元可以在栈上创建，函数执行结束时，这些内存单元会自动被释放。
栈内存分配运算内置于处理器的指令集，效率高，但是分配的内存容量有限。

## 堆（动态内存）

**保存的对象：**

1. 动态分配的对象（程序运行时分配的对象）

**生命周期：**

- 由我们手动分配和摧毁

**使用动态内存的原因：**

1. 程序不知道自己需要使用多少对象
2. 程序不知道所需对象的准确类型
3. 程序需要在多个对象间共享数据

**动态内存分配方式：**

1. 运算符：new
2. 语法：Type *pointer = new Type;
3. 返回：分配失败则返回异常

**动态内存摧毁方式：**

1. 运算符：delete
2. 语法：delete pointer;

**初始化动态分配对象：**

```c++
int *pi = new int(10);    		    //动态分配一个int对象，初始值为10
string *ps = new string(2, '9');    //动态分配一个string对象，初始值为"99"
int *pa = new int[10]();              //动态分配一个int数组，大小为10，初始值为0
```

动态内存的生命周期有程序员决定，使用非常灵活，但如果在堆上分配了空间，既有责任回收它，否则运行的程序会出现内存泄漏，频繁的分配和释放不同大小的堆空间将会产生内存碎片。

## 自由存储区

那些由new分配的内存块，由应用程序去控制，一般一个new就要对应一个delete。如果程序员没有释放掉，那么在程序结束后，操作系统会自动回收。

## 常量存储区

这是一块比较特殊的存储区，他们里面存放的是常量，不允许修改。

- 转自https://blog.csdn.net/weixin_41316331/article/details/89033197