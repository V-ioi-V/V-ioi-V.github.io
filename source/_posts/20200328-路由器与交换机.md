---
title: 中继器、集线器、网桥、交换机和路由器
tags: 计算机网络原理
category: CS大学生必备
date: 2020/03/29 10:34
---

路由器工作在网络层，交换机工作在数据链路层

<!--more-->

## 中继器

**思考问题：**主机a想和主机b通过网线进行通讯，我们知道网线的传输距离是大概100米，如果主机a和主机b之间超过了100米的距离，那么还想进行通讯该如何解决呢？

<font color="red">中继器的作用就是：扩大网络的传输距离，放大信号并转发</font>

当主机a与b之间的距离过远时，可以在他俩中间街上一个中继器，在信号到达中继器的时候中继器将网络信号扩大并转发给主机b。这就是中继器的作用。

中继器也有缺点：

- 只有两个接口
- 由于中继器对收到被衰减的信号再生（恢复）到发送时的状态，并转发出去，增加了延时

## 集线器（物理层）

**思考问题：**如果主机a和主机b想要通信用一个网线连起来就行，这时如果有个主机c也想要加入这个网络，但是网线只有两个接口，主机c怎么加入这个网络中呢？

![3.jpg](https://i.loli.net/2020/03/29/ust21Fep75SXvwa.jpg)

<font color="red">集线器的作用：集线器上面有多个网络接口，我们分别将客户机接集线器上，就形成了一个可以供多人使用的网络模型。</font>

将a、b、c都接到集线器上，他们就可以互相通信了。

集线器的缺点：

- 广播

也就是说当主机a在向主机b发送数据包的时候，要经过集线器转发，但是集线器是一个物理层设备，它无法辨别这根网线要发到哪里去，它收到数据包会以广播的形式。**发往除了接收数据包接口以外的所有接口**。这种广播造成了带宽的浪费，也造成了安全隐患，其他计算机可能会窃取到a向b发的数据包。<font color="red">这里的广播是被动的广播，是由于设备原因只能广播，和arp协议的广播不同，arp的广播是主动请求的</font>

- 半双工设备（数据单方向传输）

在同一时刻只能发送或者接收数据。

- 所有设备处在同一个冲突域和广播域

冲突域的概念(物理层概念)：连接在同一导线上的所有工作站的集合，或者说是同一物理网段上所有节点的集合或以太网上竞争同一带宽的节点集合所有直接连接在一起的，说白了**冲突域指的是会产生冲突的最小范围，在计算机和计算机通过设备互联时，会建立一条通道，如果这条通道只允许瞬间一个数据报文通过，那么在同时如果有两个或更多的数据报文想从这里通过时就会出现冲突了。**

广播域的概念：广播域是一个逻辑上的计算机组，该组内的所有计算机都会收到同样的广播信息。比如主机a发包给主机b，主机 c d e f也能收到相同的数据包。

**思考问题：**，如果有几十台或者几百台电脑想同时处在一个网络中，会造成什么情况？

答：当多个hub相连中广播过大，易造成丢包，所以我们使用网桥隔离

## 网桥（数据链路层）

<font color="red">网桥的作用：为了避免过大的网络风暴我们在hub与hub之间用网桥进行连接。能将局域网一分为2，避免每次广播都会到达每个主机</font>

​                                                                            红色点为集线器

![11.jpeg](https://i.loli.net/2020/03/29/GOWPiKFnQNlue3I.jpg)

这样A发给BCD的数据就不会再广播到EFGH了(网桥发现如果数据包不是转发给下面这个子网的，它会自动丢弃此包)，只有从A发到EFGH的数据包才能通过网桥，到达另外一个子网(网桥发现如果数据包是转发给下面这个子网的，它才会把包转发给这个子网)。这样一来，非必要的传输减少了，整个网络的效率也随之提高可不少！**因为减少了广播**

网桥的缺点：

- 由于网桥对接收的帧要先**存储和查找站表**，然后转发，这就增加了时延

- 网络上负荷很重时，可能因网桥缓冲区的存储空间不够而发生溢出，以致产生帧丢失的现象。

- 网桥只适合于用户数不太多（不超过几百个）和信息量不太大的局域网，否则有时会产生较大的广播风暴

- 只有两个接口

## 交换机（多口网桥）

**交换机的产生：**我们看到网桥虽然隔离了广播域，但是缓存空间比较小，接口只有两个，也不能适用于过大的局域网环境，为了弥补这些缺陷，就诞生了交换机。

**交换机：**交换机上有mac地址表，转发数据包的时候根据mac地址表转发

![12.jpeg](https://i.loli.net/2020/03/29/Y1IxLbykzXo4fwr.jpg)

### 网桥和交换机对比

**网桥工作原理**

![1.jpeg](https://i.loli.net/2020/03/29/5aJDNqQ1YjmwAv3.jpg)

　上图是用一个网桥连接的两个网络，网桥的A端口连接A子网，B端口连接B子网，为什么网桥知道哪些数据包该转发，哪些包不该转发呢？那是因为它有两个表A和B，当有数据包进入端口A时，网桥从数据包中提取出源MAC地址和目的MAC地址，一开始的时候，表A和表B都是空的，没有一条记录，这时，网桥会把数据包转发给B网络，并且在表A中增加一条MAC地址(把**源MAC地址记录表中**)，说明这个MAC地址的机器是A子网的，同理，当B子网发送数据包到B端口时，网桥也会记录**源MAC地址**到B表；当网桥工作一段时候后，表A基本上记录了A子网所有的机器的MAC地址，表B同理，当再有一个数据包从A子网发送给网桥时，网桥会先看看**数据包的目的MAC地址是属于A子网还是B子网的，如果从A表中找到对应则抛弃该包(在局域网中已经广播了)，如果不是，则转发给B子网**，然后检查源MAC地址，是否在表中已经存在，如果不存在，在表A中增加一条记录。

　　噢，或许你现在会问了，为什么需要两张表呢，一张表不行么？？嗯～刚才把表一分为二是为了便于理解，实际上，真正的网桥里面存的应该是一张表(当然有可能为了提速，或者其他原因，它也可能把信息存为多张表，这个得看它怎么实现了～)，如果是一张信息表，表里记录的应该是：MAC-PortNum。

**交换机原理**

![3](https://i.loli.net/2020/03/29/WfTiz2RnPQEIu8K.jpg)

　交换机也有一张MAC-PORT对应表(这张表的学名为：**CAM**)，和网桥不一样的是，**网桥的表是一对多的**(一个端口号对多个MAC地址)，但**交换机的CAM表却是一对一的**，如果一个端口有新的MAC地址，它不会新增MAC－PORT记录，而是修改原有的记录，比如：现在交换机记录表里已经有一项：MAC1-Port1，如果此刻端口1又来了一个数据包，里面的源MAC地址是MAC2，此时，交换机会刷新交换机记录表：MAC1-Port1记录被修改为MAC2－Port1，因为交换机认为是端口1的计算机MAC地址变了，如果端口1连接的一台物理机器，MAC一般是不会变的，如果连接的是另外一个交换机，那这个端口的记录会变化得比较频繁(如上图的Port12，它是对外的接口，与一个局域网连接)，另外，**如果CAM表中没有找到和数据包的目的MAC地址对应的记录，交换机会对此数据包进行广播，发给本交换机的每一个端口。**

### 网桥和交换机缓存的对比

**网桥和交换机还有一个特点：缓存**

网桥和交换机都有一定量的缓存，因为网桥和交换机转发数据包需要一些额外的操作，所以可能会占用一些时间，为了避免出现因来不及转发数据，导致大量数据丢失的情况，网桥和交换机就出现了缓存。当然，缓存不是万能的，当网桥或交换机处理不及并且缓存用完了，以后再来的数据还是会丢失的。还一个网桥需要缓存的原因是：网桥接两个传输速率不同的局域网，比如：802.3的传输速率说10mb/s，但实际上并不是真的10Mb/s，而 802.4(几乎)确实为10Mb/s，但两个局域网桥接时候必须是速率一样的，否则会有包丢失，而缓存也正好可以为不同速率网络连接时所使用。这里需要对比一下网桥和交换机的缓存，一般来说，网桥的缓存量是大于交换机的缓存量，因为网桥天生是为了连接两个网络的，两个网络桥接时所要处理的数据量会比一般的交换机需要处理的数据量要多，所以网桥的缓存也一般要比交换机大一点。

### 网桥和交换机总结

**这里再次总结一下网桥和交换机**：

网桥和交换机用户**分割冲突域**，就是网桥和交换机可以较少**被逼的广播(hub导致的)**，但**不能分割广播域**。不严格地说，交换机可以看作网桥的高度集成。

**冲突域**：总的来说，**冲突域就是连接在同一导线上的所有工作站的集合，或者说是同一物理网段上所有节点的集合，或以太网上竞争同一带宽的节点集合**。HUB这种设备不能分割冲突域。

**广播域**：网络中能接收任一设备发出的广播帧的所有设备的集合。

集线器所有端口都在同一个广播域，冲突域内。
交换机所有端口都在同一个广播域内，而每一个端口就是一个冲突域。
路由器的每个端口属于不同的广播域。

## 路由器（router）



以上我们说的都是同网段进行通讯的时候会用到，hub，中继器，网桥和交换机，那么我们在进行跨网段通讯时，就用到了我们的路由器。

**思考问题：**我们刚刚说在进行跨网段通讯的时候才会用到路由器，那么能不能不划分网段，全部都用交换机进行通讯呢？

答案是不可以的，



![4.jpg](https://i.loli.net/2020/03/29/9XeQ3kUgtTPBIEw.jpg)



看这张图，我们把四台交换机连接起来，当主机a发了一个广播包之后，广播包可以在交换机之间进行传递，那么此时主机b主机c都能收到这个广播包，我们都知道一般每台交换机上都有几十个端口，如果这四台交换机的几十个端口上都接了电脑，那么主机a发了广播包之后就会有数百人能够收到广播，这样就浪费了带宽，如果有多台电脑都发送了广播呢？如果在增加了几十台交换呢？就会造成带宽被极大的浪费，数据的发送也受到了拥堵。

**为了隔离这样的广播域**，我们引入了路由器这样一款设备，那么它的工作原理是什么呢？

答：路由器的工作原理是查表转发，与交换机不同的是交换机查的是mac地址表，路由器查的是路由表。

那么他怎样进行查表呢？我们看下面这样一张图



![5.jpg](https://i.loli.net/2020/03/29/R1wHvmhAzoXPVj5.jpg)





首先我们知道，我们的电脑想要上网的话·都要设置一个网关，这个**网关的作用就是我们在进行跨网段通讯的时候将数据包交给我们的网关，然后由网关替我们去转发**，此时路由器就是我们的网关。我们知道所有的设备在进行互访的时候都需要知道对方的ip地址，这时候当电脑1去访问电脑2，我们电脑1发现自己与电脑2不在同一个网段，将数据包发给网关（路由器），路由器会看到电脑1发来的数据包的目的ip是多少，然后查找自己有没有去往这个地址的路由条目，有的话则转发，没有则丢弃。

### 路由器和交换机的区别

**工作层次不同：**
交换机主要工作在数据链路层（第二层）
路由器工作在网络层（第三层）。
**转发依据不同：**
交换机转发所依据的对象时：MAC地址。（物理地址）
路由转发所依据的对象是：IP地址。（网络地址）
**主要功能不同：**
交换机主要用于组建局域网，
而路由主要功能是将由交换机组好的局域网相互连接起来，或者接入Internet。
<font size=4 color="red">交换机能做的，路由都能做，路由器和交换机硬件上是差不多的，却别只在软件上，路由器可以当做交换机来使用</font>
交换机不能分割广播域，路由可以。
路由还可以提供防火墙的功能。
路由配置比交换机复杂。

